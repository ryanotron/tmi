{% extends 'basepage.html' %}

{% block head %}
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">google.load('visualization','1', {packages:['corechart']});</script>
{% if coffee_stats -%}
{% set daily_cups = coffee_stats['daily_cups'] -%}
{% include 'js_coffee_chart.html' %}
{% endif %}

{% if sleep_stats -%}
{% set sleep_list = sleep_stats['sleep_list'] -%}
{% include 'js_sleep_chart.html' %}
{% endif %}
{% endblock %}

{% block content %}
<div class="BlockWrapper" id="PersonalInfo">
    <h2>Too much information on</h2>
    <h1>{{user.salutation}} {{user.realname}}</h1>
    <div id="UserPhoto">
        <img src="../img?img_key={{user.key()}}"></img>
    </div>
    <p>Last seen on {{(user.last_seen + datetime.timedelta(hours = user.timezone)).strftime('%d/%m/%Y, %H:%M')}} UTC {{'%+2.1f' % user.timezone}}</p>
    {% set user_messages = stats.user_messages(user, 1) -%}
    {% if user_messages -%}
        <h3>Latest message from {{user.salutation}} {{user.realname}}</h3>
        <p class="UserMessage">{{user_messages[0].message}}</p>
    {% endif -%}
</div>

<div class="BlockWrapper" id="Energy">
    <h2>Energy</h2>    
    {% set meal_status = stats.meal_status(user) -%}
    <div class="Sub_BlockWrapper">
        <h3>Sleep</h3>
    {% if sleep_stats -%}
        <p>{{user.salutation}} {{user.realname}} woke up at {{sleep_stats['latest_waketime'].strftime('%H:%M')}} after {{'%2.2f' % sleep_stats['latest_duration']}} hours of sleep. {{user.nom_pronoun}} slept for, on average, {{'%2.2f' % sleep_stats['lastweek_average']}} hours per day last week, and for {{'%2.2f' % sleep_stats['alltime_average']}} hours all time. To maintain {{user.pos_determi}} all time average {{user.salutation}} {{user.realname}} has a sleep debt of {{'%2.2f' % sleep_stats['debt_by_alltime']}} hours.</p>
    {% else -%}
        <p>{{user.salutation}} {{user.realname}} has not recorded any sleep time yet. Perhaps {{user.nom_pronoun}} has cracked the secret for not needing sleep and is cruelly withholding it from us?</p>
    {% endif %}
        <div class="ChartWrapper">
            <h3>{{user.salutation}} {{user.realname}}'s sleep hours</h3>
            <div id="sleep_chart">
        </div>
    </div>
    
    <div class="Sub_BlockWrapper">
        <h3>Coffee</h3>
        {% if coffee_stats -%}
            <p>{{user.salutation}} {{user.realname}}'s last cup of coffee was {{'%2.2f' % coffee_stats['last_cup']}} hours ago. Today {{user.nom_pronoun}} has had {{'%2d' % coffee_stats['todays_total']}} cup(s). On average {{user.nom_pronoun}} drinks {{'%1.2f' % coffee_stats['alltime_average']}} cups a day.</p>
        {% else -%}
            <p>{{user.salutation}} {{user.realname}} has not shared {{user.pos_determi}} habits yet. Could {{user.nom_pronoun}} be a milk drinker?</p>
        {% endif %}

        <div class="ChartWrapper">
            <h3>{{user.salutation}} {{user.realname}}'s daily cup of coffee
            <div id="coffee_chart"></div>
        </div>
    </div>
    
    <div class="Sub_BlockWrapper">
        <h3>Meal</h3>
    {% if meal_status['meal_time'] %}
        <p>Latest meal was a {{meal_status['latest_category']}} at {{meal_status['meal_time'].strftime('%d/%m/%Y %H:%M')}}, with menu {{meal_status['latest_menu']}}</p>
    {% else %}
        <p>{{user.salutation}} {{user.realname}} has not recorded any meal yet. We cannot know if {{user.salutation}} {{user.realname}} is well fed or not</p>
    {% endif %}
    </div>
</div>

<div class="BlockWrapper" id="Hygiene">
    <h2>Hygiene</h2>
    {% set shower_status = stats.activity_status(user, 'shower', 1) %}
    {% set shave_status = stats.activity_status(user, 'shave', 1) %}
    {% set haircut_status = stats.activity_status(user, 'cut hair', 1) %}
    {% set shower_interval = stats.average_time_between_activities(user, 'shower') / (60.0 * 60.0) %}
    {% set shave_interval = stats.average_time_between_activities(user, 'shave') / (60.0 * 60.0 * 24.0) %}
    {% set haircut_interval = stats.average_time_between_activities(user, 'cut hair') / (60.0 * 60.0 * 24.0) %}
    
    {% if shower_status['timelatest'] %}
        <p>{{user.salutation}} {{user.realname}} last showered {{'%2.2f' % (shower_status['timesince'] / (60.0 * 60.0))}} hours ago.</p>
        <p>{{user.salutation}} {{user.realname}} usually showers every {{'%2.2f' % shower_interval}} hours</p>
    {% else %}
        <p>{{user.salutation}} {{user.realname}} has not recorded to have showered yet. We can only hope that {{user.salutation}} {{user.realname}} is not stinky</p>
    {% endif %}
    {% if shave_status['timelatest'] %}
        <p>{{user.salutation}} {{user.realname}} last shaved {{'%2.2f' % (shave_status['timesince'] / (60.0 * 60.0 * 24))}} day(s) ago.</p>
        <p>{{user.salutation}} {{user.realname}} usually shaves every {{'%1.2f' % shave_interval}} days</p>
    {% else %}
        <p>{{user.salutation}} {{user.realname}} has not recorded to have shaved yet. Perhaps {{user.salutation}} {{user.realname}} is trying to grow a manscape?</p>
    {% endif %}
    {% if haircut_status['timelatest'] %}
        <p>{{user.salutation}} {{user.realname}} last got a haircut {{'%2.2f' % (haircut_status['timesince'] / (60.0 * 60.0 * 24))}} day(s) ago.</p>
        <p>{{user.salutation}} {{user.realname}} usually gets a haircut every {{'%1.2f' % haircut_interval}} days</p>
    {% else %}
        <p>{{user.salutation}} {{user.realname}} has not recorded any haircut yet. Perhaps {{user.salutation}} {{user.realname}} is trying to grow beautiful long locks?</p>
    {% endif %}
</div>

<div class="BlockWrapper" id="GuestComment">
    <h2>Tell {{user.salutation}} {{user.realname}} something</h2>
    <form class="GuestComment" method="post" action="/postguestmessage">
        Your name: <input type="text" name="guest_name"><br>
        Your message:<br>
        <textarea name="guest_message"></textarea>
        <input type="hidden" name="userid" value="{{user.key().id()}}"><br>
        <input type="submit">
    </form><br>
</div>

<div class="BlockWrapper" id="PrevComments">
    {% set messages = stats.guest_messages(user, 3) -%}
    <h2>What people has told {{user.salutation}} {{user.realname}}</h2>
    {% if messages -%}
        {% for message in messages -%}
            {{message.guestname}} said on {{(message.when + datetime.timedelta(hours = user.timezone)).strftime('%d/%m/%Y %H:%M')}}:<br>
            {{message.message}}<br><hr>
        {% endfor -%}
    {% else %}
        Nobody has told {{user.salutation}} {{user.realname}} anything yet. Be the first!
    {% endif %}
</div>
    
{% endblock %}